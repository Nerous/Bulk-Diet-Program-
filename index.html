<!DOCTYPE html>
<html lang="ka">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#0a0a0f">
<title>BULK MODE üèãÔ∏è</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
body{background:#0a0a0f;color:#e0e0e0;font-family:'Segoe UI',system-ui,-apple-system,sans-serif;max-width:480px;margin:0 auto;overflow-x:hidden;min-height:100vh}
input[type=number]::-webkit-inner-spin-button{-webkit-appearance:none}
input{-webkit-appearance:none;appearance:none}
button{-webkit-appearance:none;appearance:none}
::-webkit-scrollbar{width:0;height:0}
.header{background:linear-gradient(135deg,#ff6b35,#f7c948);padding:14px 18px 12px;position:sticky;top:0;z-index:50}
.tab-bar{position:fixed;bottom:0;left:50%;transform:translateX(-50%);width:100%;max-width:480px;background:rgba(10,10,15,.97);border-top:1px solid #1a1a1a;display:flex;padding:5px 0 max(8px,env(safe-area-inset-bottom));z-index:100;backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px)}
.tab-btn{flex:1;background:none;border:none;color:#444;cursor:pointer;text-align:center;padding:2px 0;transition:color .2s}
.tab-btn.active{color:#ff6b35}
.tab-btn .icon{font-size:18px;margin-bottom:1px}
.tab-btn .label{font-size:8px;font-weight:400}
.tab-btn.active .label{font-weight:700}
.content{padding:12px 16px;padding-bottom:80px;min-height:60vh}
.card{background:rgba(255,255,255,.03);border-radius:14px;padding:14px;margin-bottom:10px;border:1px solid rgba(255,255,255,.06)}
.bar-wrap{width:100%}
.bar-label{display:flex;justify-content:space-between;font-size:10px;color:#888;margin-bottom:2px}
.bar-bg{width:100%;height:8px;background:rgba(255,255,255,.06);border-radius:20px;overflow:hidden}
.bar-fill{height:100%;border-radius:20px;transition:width .4s cubic-bezier(.4,0,.2,1)}
.stat{flex:1;border-radius:12px;padding:10px 6px;text-align:center}
.stat .val{font-size:18px;font-weight:900}
.stat .lbl{font-size:9px;color:#777}
.inp{padding:9px 12px;border-radius:10px;border:1px solid #333;background:#111;color:#fff;font-size:13px;outline:none;width:100%}
.inp:focus{border-color:#ff6b35}
.btn{padding:10px 18px;border-radius:10px;font-weight:700;font-size:13px;cursor:pointer;border:none;transition:opacity .2s}
.btn:active{opacity:.7}
.btn-primary{background:#ff6b35;color:#000}
.btn-outline{background:rgba(255,107,53,.1);color:#ff6b35;border:1px solid rgba(255,107,53,.25)}
.btn-sm{padding:6px 12px;font-size:12px}
.btn-full{width:100%}
.btn-danger{background:rgba(239,83,80,.08);color:#ef5350;border:1px solid rgba(239,83,80,.2)}
.overlay{position:fixed;inset:0;z-index:200;display:flex;align-items:flex-end;justify-content:center}
.overlay-bg{position:absolute;inset:0;background:rgba(0,0,0,.7)}
.modal{position:relative;width:100%;max-width:480px;max-height:85vh;background:#151520;border-radius:20px 20px 0 0;padding:20px 16px;overflow-y:auto}
.modal-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
.modal-title{font-size:16px;font-weight:800}
.modal-close{background:#222;border:none;color:#888;width:32px;height:32px;border-radius:10px;font-size:16px;cursor:pointer}
.meal-card{border-radius:12px;overflow:hidden;transition:all .2s}
.meal-check{width:26px;height:26px;border-radius:7px;border:2px solid #444;background:transparent;color:#fff;font-size:13px;cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:all .2s}
.meal-check.done{border:none;background:#4caf50}
.chip{padding:1px 6px;border-radius:12px;font-size:10px;font-weight:700}
.day-btn{min-width:48px;padding:6px 3px;border-radius:10px;border:2px solid #222;background:#111;color:#666;cursor:pointer;text-align:center;font-size:11px;transition:all .15s}
.day-btn.active{border-color:#ff6b35;background:rgba(255,107,53,.12);color:#ff6b35}
.shop-item{border-radius:11px;padding:9px 10px;border:1px solid rgba(255,255,255,.04);transition:all .2s}
.shop-item.done{background:rgba(76,175,80,.05);border-color:rgba(76,175,80,.15)}
.qty-btn{width:36px;height:28px;border-radius:8px;border:none;font-weight:900;font-size:16px;cursor:pointer;transition:opacity .15s}
.qty-btn:active{opacity:.6}
.prod-row{display:flex;padding:8px 0;border-bottom:1px solid rgba(255,255,255,.03);align-items:center;cursor:pointer;transition:background .15s}
.prod-row:active{background:rgba(255,255,255,.03)}
.emoji-btn{width:36px;height:36px;border-radius:8px;font-size:18px;border:none;cursor:pointer;transition:transform .1s}
.emoji-btn:active{transform:scale(.9)}
.prep-btn{margin-top:6px;margin-left:34px;padding:3px 10px;background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);border-radius:6px;color:#777;font-size:10px;cursor:pointer}
.prep-content{padding:8px 12px 10px 48px;background:rgba(247,201,72,.03);border-top:1px solid rgba(255,255,255,.03);font-size:11px;color:#bbb;line-height:1.5}
.history-item{display:flex;align-items:center;gap:10px;padding:8px 10px;background:#111;border-radius:10px}
@media(max-width:380px){.stat .val{font-size:15px}.header{padding:12px 14px 10px}}
</style>
</head>
<body>
<div id="root"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
<script type="text/babel">
const {useState,useReducer,useEffect,useCallback}=React;

// ‚ïê‚ïê‚ïê STORAGE ‚ïê‚ïê‚ïê
const STORAGE_KEY="bulkmode_v2";
const save=s=>{try{localStorage.setItem(STORAGE_KEY,JSON.stringify(s))}catch(e){}};
const load=()=>{try{const d=localStorage.getItem(STORAGE_KEY);return d?JSON.parse(d):null}catch(e){return null}};

// ‚ïê‚ïê‚ïê DATA ‚ïê‚ïê‚ïê
const DEF_PRODUCTS=[
  {id:"chicken_fillet",name:"·É•·Éê·Éó·Éõ·Éò·É° ·É§·Éò·Éö·Éî",unit:"·Éô·Éí",price:10.3,prot:23,cal:133,store:"Sursati",emoji:"üçó"},
  {id:"chicken_thigh",name:"·É•·Éê·Éó·Éõ·Éò·É° ·Éë·Éê·É†·Éô·Éê·Éö·Éò",unit:"·Éô·Éí",price:7.5,prot:18,cal:190,store:"Sursati",emoji:"üçó"},
  {id:"eggs_30",name:"·Éô·Éï·Éî·É†·É™·ÉÆ·Éò (30·É™)",unit:"·É®·Éî·É§·É£·Éó·Éï·Éê",price:10.5,prot:13,cal:155,store:"2 ·Éú·Éê·Éë·Éò·ÉØ·Éò",emoji:"ü•ö"},
  {id:"oats",name:"·É®·Éï·É†·Éò·Éê",unit:"·Éô·Éí",price:2.9,prot:13,cal:367,store:"Sursati",emoji:"ü•£"},
  {id:"rice",name:"·Éë·É†·Éò·Éú·ÉØ·Éò",unit:"·Éô·Éí",price:2.5,prot:7,cal:365,store:"Sursati",emoji:"üçö"},
  {id:"cottage",name:"·ÉÆ·Éê·É≠·Éù",unit:"·Éô·Éí",price:7.5,prot:18,cal:113,store:"2 ·Éú·Éê·Éë·Éò·ÉØ·Éò",emoji:"üßÄ"},
  {id:"yogurt",name:"·Éõ·Éê·É¨·Éù·Éú·Éò",unit:"·Éö·Éò·É¢·É†·Éò",price:3.0,prot:5,cal:56,store:"2 ·Éú·Éê·Éë·Éò·ÉØ·Éò",emoji:"ü•õ"},
  {id:"lentils",name:"·Éù·É°·Éû·Éò",unit:"·Éô·Éí",price:5.6,prot:25,cal:353,store:"Sursati",emoji:"ü´ò"},
  {id:"beans",name:"·Éö·Éù·Éë·Éò·Éù",unit:"·Éô·Éí",price:3.8,prot:21,cal:333,store:"·Éë·Éê·Éñ·Éê·É†·Éò",emoji:"ü´ò"},
  {id:"pasta",name:"·Éõ·Éê·Éô·Éê·É†·Éù·Éú·Éò",unit:"·Éô·Éí",price:3.4,prot:12,cal:350,store:"2 ·Éú·Éê·Éë·Éò·ÉØ·Éò",emoji:"üçù"},
  {id:"pb",name:"·Éê·É†·Éê·É•·Éò·É°·Éò·É° ·Éô·Éê·É†·Éê·É•·Éò",unit:"350·Éí",price:7.5,prot:25,cal:588,store:"·Éî·Éï·É†·Éù·Éû·É†·Éù·Éì·É£·É•·É¢·Éò",emoji:"ü•ú"},
  {id:"banana",name:"·Éë·Éê·Éú·Éê·Éú·Éò",unit:"·Éô·Éí",price:4.0,prot:1,cal:89,store:"·Éõ·Éê·Éí·Éú·Éò·É¢·Éò",emoji:"üçå"},
  {id:"bread",name:"·Éû·É£·É†·Éò (·É†·É£·ÉÆ·Éò)",unit:"·É™·Éê·Éö·Éò",price:1.2,prot:9,cal:250,store:"2 ·Éú·Éê·Éë·Éò·ÉØ·Éò",emoji:"üçû"},
  {id:"oil",name:"·Éñ·Éî·Éó·Éò",unit:"·Éö·Éò·É¢·É†·Éò",price:4.5,prot:0,cal:884,store:"Sursati",emoji:"ü´í"},
  {id:"apple",name:"·Éï·Éê·É®·Éö·Éò",unit:"·Éô·Éí",price:2.8,prot:0,cal:52,store:"·Éë·Éê·Éñ·Éê·É†·Éò",emoji:"üçé"},
  {id:"nuts",name:"·Éó·ÉÆ·Éò·Éö·Éò/·Éú·É£·É®·Éò",unit:"200·Éí",price:5.0,prot:15,cal:607,store:"·Éë·Éê·Éñ·Éê·É†·Éò",emoji:"üå∞"},
  {id:"veggies",name:"·Éë·Éù·É°·É¢·Éú·Éî·É£·Éö·Éò",unit:"·Éô·Éí",price:3.0,prot:2,cal:30,store:"·Éë·Éê·Éñ·Éê·É†·Éò",emoji:"ü•¨"},
  {id:"honey",name:"·Éó·Éê·É§·Éö·Éò",unit:"500·Éí",price:12.0,prot:0,cal:304,store:"·Éë·Éê·Éñ·Éê·É†·Éò",emoji:"üçØ"},
];

const DEF_NEEDS=[
  {id:"chicken_fillet",qty:12},{id:"eggs_30",qty:6},{id:"oats",qty:3},{id:"rice",qty:5},
  {id:"cottage",qty:4},{id:"yogurt",qty:9},{id:"lentils",qty:2},{id:"beans",qty:2},
  {id:"pasta",qty:3},{id:"pb",qty:2},{id:"banana",qty:7},{id:"bread",qty:15},
  {id:"oil",qty:1},{id:"veggies",qty:5},{id:"nuts",qty:3},
];

const MENU=[
  {day:"·Éù·É†·É®",emoji:"üí™",meals:[
    {t:"08:00",l:"·É°·Éê·É£·Éñ·Éõ·Éî",d:"·É®·Éï·É†·Éò·Éê 100·Éí + 3 ·Éô·Éï·Éî·É†·É™·ÉÆ·Éò + ·Éë·Éê·Éú·Éê·Éú·Éò + ·Éó·Éê·É§·Éö·Éò",p:28,c:650,prep:"·É®·Éï·É†·Éò·Éê ·É¨·Éß·Éê·Éö·É®·Éò 5·É¨·Éó, ·Éô·Éï·Éî·É†·É™·ÉÆ·Éò ·É®·Éî·É¨·Éï·Éò"},
    {t:"10:30",l:"·É°·Éú·Éî·Éô·Éò",d:"·Éê·É†·Éê·É•·Éò·É°·Éò·É° ·Éô·Éê·É†·Éê·É•·Éò 2·É°/·Éô + ·Éû·É£·É†·Éò 2·Éú·Éê·É≠.",p:12,c:350,prep:"·Éû·É£·É†·Éñ·Éî ·É¨·Éê·Éò·É°·Éï·Éò"},
    {t:"13:00",l:"·Éö·Éê·Éú·É©·Éò",d:"·É•·Éê·Éó·Éõ·Éò·É° ·É§·Éò·Éö·Éî 250·Éí + ·Éë·É†·Éò·Éú·ÉØ·Éò 150·Éí + ·É°·Éê·Éö·Éê·Éó·Éò",p:55,c:780,prep:"·É•·Éê·Éó·Éõ·Éò ·É¢·Éê·É§·Éê·Éñ·Éî 6-7·É¨·Éó ·Éù·É†·Éò·Éï·Éî ·Éõ·ÉÆ·É†·Éò·Éì·Éê·Éú"},
    {t:"16:00",l:"·É°·Éú·Éî·Éô·Éò 2",d:"3 ·Éõ·Éù·ÉÆ·Éê·É†·É®·É£·Éö·Éò ·Éô·Éï·Éî·É†·É™·ÉÆ·Éò + ·Éë·Éê·Éú·Éê·Éú·Éò",p:20,c:330,prep:"·É¨·Éò·Éú·Éê·É°·É¨·Éê·É† ·Éõ·Éù·ÉÆ·Éê·É†·É®·É£·Éö·Éò ·Éõ·Éê·É™·Éò·Éï·É†·Éò·Éì·Éê·Éú"},
    {t:"19:00",l:"·Éï·Éê·ÉÆ·É®·Éê·Éõ·Éò",d:"·É•·Éê·Éó·Éõ·Éò 200·Éí + ·Éõ·Éê·Éô·Éê·É†·Éù·Éú·Éò 120·Éí + ·Éë·Éù·É°·É¢·Éú·Éî·É£·Éö·Éò",p:48,c:700,prep:"·Éõ·Éê·Éô·Éê·É†·Éù·Éú·Éò ·Éõ·Éù·ÉÆ·Éê·É†·É®·Éî, ·É•·Éê·Éó·Éõ·Éò ·É®·Éî·É¨·Éï·Éò"},
    {t:"22:00",l:"·É´·Éò·Éö·Éò·É° ·É¨·Éò·Éú",d:"·ÉÆ·Éê·É≠·Éù 200·Éí + ·Éó·ÉÆ·Éò·Éö·Éò 30·Éí",p:22,c:280,prep:"·ÉÆ·Éê·É≠·Éù + ·Éó·ÉÆ·Éò·Éö·Éò ·Éñ·Éî·Éõ·Éù·Éì·Éê·Éú"},
  ]},
  {day:"·É°·Éê·Éõ",emoji:"üî•",meals:[
    {t:"08:00",l:"·É°·Éê·É£·Éñ·Éõ·Éî",d:"·É®·Éï·É†·Éò·Éê 100·Éí + 2 ·Éô·Éï·Éî·É†·É™·ÉÆ·Éò + ·Éó·Éê·É§·Éö·Éò",p:22,c:580,prep:"·É®·Éï·É†·Éò·Éê + ·Éù·Éõ·Éö·Éî·É¢·Éò"},
    {t:"10:30",l:"·É°·Éú·Éî·Éô·Éò",d:"·ÉÆ·Éê·É≠·Éù 150·Éí + ·Éë·Éê·Éú·Éê·Éú·Éò",p:15,c:280,prep:"·É®·Éî·É£·É†·Éò·Éî"},
    {t:"13:00",l:"·Éö·Éê·Éú·É©·Éò",d:"·É•·Éê·Éó·Éõ·Éò·É° ·Éë·Éê·É†·Éô·Éê·Éö·Éò 300·Éí + ·Éë·É†·Éò·Éú·ÉØ·Éò 150·Éí + ·É°·Éê·Éö·Éê·Éó·Éò",p:50,c:820,prep:"·Éë·Éê·É†·Éô·Éê·Éö·Éò ·É¶·É£·Éõ·Éî·Éö·É®·Éò 25-30·É¨·Éó"},
    {t:"16:00",l:"·É°·Éú·Éî·Éô·Éò 2",d:"·É®·Éï·É†·Éò·Éê 50·Éí + ·Éê·É†·Éê·É•·Éò·É°·Éò·É° ·Éô·Éê·É†·Éê·É•·Éò",p:12,c:320,prep:"·É®·Éî·É£·É†·Éò·Éî"},
    {t:"19:00",l:"·Éï·Éê·ÉÆ·É®·Éê·Éõ·Éò",d:"·Éù·É°·Éû·Éò·É° ·É¨·Éï·Éú·Éò·Éê·Éú·Éò + ·É•·Éê·Éó·Éõ·Éò 150·Éí + ·Éû·É£·É†·Éò",p:45,c:720,prep:"·Éù·É°·Éû·Éò 15-20·É¨·Éó ·ÉÆ·Éê·ÉÆ·Éï·Éò·Éó"},
    {t:"22:00",l:"·É´·Éò·Éö·Éò·É° ·É¨·Éò·Éú",d:"·Éõ·Éê·É¨·Éù·Éú·Éò 300·Éõ·Éö + ·Éó·ÉÆ·Éò·Éö·Éò 30·Éí",p:18,c:260,prep:"·É≠·Éò·É•·Éê·É®·Éò"},
  ]},
  {day:"·Éù·Éó·ÉÆ",emoji:"‚ö°",meals:[
    {t:"08:00",l:"·É°·Éê·É£·Éñ·Éõ·Éî",d:"·Éù·Éõ·Éö·Éî·É¢·Éò 4 ·Éô·Éï·Éî·É†·É™·ÉÆ·Éò + ·Éß·Éï·Éî·Éö·Éò 30·Éí + ·Éû·É£·É†·Éò",p:34,c:650,prep:"·É¢·Éê·É§·Éê·Éñ·Éî 3-4·É¨·Éó"},
    {t:"10:30",l:"·É°·Éú·Éî·Éô·Éò",d:"·Éë·Éê·Éú·Éê·Éú·Éò 2·É™·Éê·Éö·Éò + ·Éê·É†·Éê·É•·Éò·É°·Éò·É° ·Éô·Éê·É†·Éê·É•·Éò",p:10,c:380,prep:"·Éë·Éê·Éú·Éê·Éú·Éò + ·Éô·Éê·É†·Éê·É•·Éò"},
    {t:"13:00",l:"·Éö·Éê·Éú·É©·Éò",d:"·É•·Éê·Éó·Éõ·Éò·É° ·É§·Éò·Éö·Éî 250·Éí + ·Éë·É†·Éò·Éú·ÉØ·Éò 150·Éí + ·É°·Éê·Éö·Éê·Éó·Éò",p:55,c:780,prep:"Meal prep-·Éò·Éì·Éê·Éú!"},
    {t:"16:00",l:"·É°·Éú·Éî·Éô·Éò 2",d:"·Éõ·Éù·ÉÆ·Éê·É†·É®·É£·Éö·Éò ·Éô·Éï·Éî·É†·É™·ÉÆ·Éò 3 + ·Éï·Éê·É®·Éö·Éò",p:19,c:300,prep:"·Éõ·Éê·É™·Éò·Éï·É†·Éò·Éì·Éê·Éú"},
    {t:"19:00",l:"·Éï·Éê·ÉÆ·É®·Éê·Éõ·Éò",d:"·Éö·Éù·Éë·Éò·Éù + ·Éë·É†·Éò·Éú·ÉØ·Éò 150·Éí + ·É•·Éê·Éó·Éõ·Éò 150·Éí",p:44,c:720,prep:"·Éö·Éù·Éë·Éò·Éù 40-50·É¨·Éó (·É¨·Éò·Éú·Éê ·É¶·Éê·Éõ·Éò·Éó ·Éì·Éê·Éö·Éë·Éî!)"},
    {t:"22:00",l:"·É´·Éò·Éö·Éò·É° ·É¨·Éò·Éú",d:"·ÉÆ·Éê·É≠·Éù 200·Éí + ·Éë·Éê·Éú·Éê·Éú·Éò",p:20,c:260,prep:"·É®·Éî·É£·É†·Éò·Éî"},
  ]},
  {day:"·ÉÆ·É£·Éó",emoji:"üèãÔ∏è",meals:[
    {t:"08:00",l:"·É°·Éê·É£·Éñ·Éõ·Éî",d:"·É®·Éï·É†·Éò·Éê 100·Éí + 3 ·Éô·Éï·Éî·É†·É™·ÉÆ·Éò + ·Éï·Éê·É®·Éö·Éò",p:28,c:620,prep:"·É®·Éï·É†·Éò·Éê + ·Éõ·Éù·ÉÆ·Éê·É†·É®·É£·Éö·Éò ·Éô·Éï·Éî·É†·É™·ÉÆ·Éò"},
    {t:"10:30",l:"·É°·Éú·Éî·Éô·Éò",d:"·Éû·É£·É†·Éò + ·Éê·É†·Éê·É•. ·Éô·Éê·É†·Éê·É•·Éò + ·Éó·Éê·É§·Éö·Éò",p:10,c:400,prep:"·É°·Éî·Éú·Éì·Éï·Éò·É©·Éò"},
    {t:"13:00",l:"·Éö·Éê·Éú·É©·Éò",d:"·É•·Éê·Éó·Éõ·Éò·É° ·Éë·Éê·É†·Éô·Éê·Éö·Éò 300·Éí + ·Éõ·Éê·Éô·Éê·É†·Éù·Éú·Éò 150·Éí",p:50,c:800,prep:"·Éë·Éê·É†·Éô·Éê·Éö·Éò ·É¢·Éê·É§·Éê·Éñ·Éî/·É¶·É£·Éõ·Éî·Éö·É®·Éò"},
    {t:"16:00",l:"·É°·Éú·Éî·Éô·Éò 2",d:"·ÉÆ·Éê·É≠·Éù 200·Éí + ·Éë·Éê·Éú·Éê·Éú·Éò",p:20,c:280,prep:"·ÉÆ·Éê·É≠·Éù + ·Éë·Éê·Éú·Éê·Éú·Éò"},
    {t:"19:00",l:"·Éï·Éê·ÉÆ·É®·Éê·Éõ·Éò",d:"·É•·Éê·Éó·Éõ·Éò·É° ·É§·Éò·Éö·Éî 200·Éí + ·Éë·É†·Éò·Éú·ÉØ·Éò 150·Éí + ·É°·Éê·Éö·Éê·Éó·Éò",p:48,c:700,prep:"Meal prep"},
    {t:"22:00",l:"·É´·Éò·Éö·Éò·É° ·É¨·Éò·Éú",d:"·Éõ·Éê·É¨·Éù·Éú·Éò 300·Éõ·Éö + ·Éó·ÉÆ·Éò·Éö·Éò 30·Éí",p:18,c:260,prep:"·É≠·Éò·É•·Éê·É®·Éò"},
  ]},
  {day:"·Éû·Éê·É†",emoji:"üí•",meals:[
    {t:"08:00",l:"·É°·Éê·É£·Éñ·Éõ·Éî",d:"·Éô·Éï·Éî·É†·É™·ÉÆ·Éò 4 ·É¢·Éê·É§·Éê·Éñ·Éî + ·Éû·É£·É†·Éò + ·Éë·Éê·Éú·Éê·Éú·Éò",p:30,c:640,prep:"4 ·Éô·Éï·Éî·É†·É™·ÉÆ·Éò + ·Éñ·Éî·Éó·Éò"},
    {t:"10:30",l:"·É°·Éú·Éî·Éô·Éò",d:"·É®·Éï·É†·Éò·Éê 80·Éí + ·Éë·Éê·Éú·Éê·Éú·Éò + ·Éó·Éê·É§·Éö·Éò",p:12,c:380,prep:"·É®·Éï·É†·Éò·Éê + ·Éë·Éê·Éú·Éê·Éú·Éò + ·Éó·Éê·É§·Éö·Éò"},
    {t:"13:00",l:"·Éö·Éê·Éú·É©·Éò",d:"·É•·Éê·Éó·Éõ·Éò·É° ·É§·Éò·Éö·Éî 250·Éí + ·Éë·É†·Éò·Éú·ÉØ·Éò 150·Éí + ·Éô·Éù·Éõ·Éë·Éù·É°·É¢·Éù",p:55,c:760,prep:"Meal prep!"},
    {t:"16:00",l:"·É°·Éú·Éî·Éô·Éò 2",d:"·Éê·É†·Éê·É•. ·Éô·Éê·É†·Éê·É•·Éò + ·Éû·É£·É†·Éò",p:12,c:350,prep:"·É°·Éî·Éú·Éì·Éï·Éò·É©·Éò"},
    {t:"19:00",l:"·Éï·Éê·ÉÆ·É®·Éê·Éõ·Éò",d:"·Éù·É°·Éû·Éò + ·É•·Éê·Éó·Éõ·Éò 200·Éí + ·É°·Éê·Éö·Éê·Éó·Éò",p:48,c:720,prep:"·Éù·É°·Éû·Éò 15-20·É¨·Éó"},
    {t:"22:00",l:"·É´·Éò·Éö·Éò·É° ·É¨·Éò·Éú",d:"·ÉÆ·Éê·É≠·Éù 200·Éí + ·Éï·Éê·É®·Éö·Éò",p:18,c:230,prep:"·ÉÆ·Éê·É≠·Éù + ·Éï·Éê·É®·Éö·Éò"},
  ]},
  {day:"·É®·Éê·Éë",emoji:"üéØ",meals:[
    {t:"08:00",l:"·É°·Éê·É£·Éñ·Éõ·Éî",d:"·É®·Éï·É†·Éò·Éò·É° ·Éë·Éö·Éò·Éú·Éò (3·Éô·Éï·Éî·É†·É™·ÉÆ·Éò) + ·Éó·Éê·É§·Éö·Éò + ·Éë·Éê·Éú·Éê·Éú·Éò",p:26,c:680,prep:"·Éë·Éö·Éî·Éú·Éì·Éî·É†·É®·Éò ·É®·Éï·É†·Éò·Éê+·Éô·Éï·Éî·É†·É™·ÉÆ·Éò+·É†·É´·Éî, ·É¢·Éê·É§·Éê·Éñ·Éî 2·É¨·Éó"},
    {t:"10:30",l:"·É°·Éú·Éî·Éô·Éò",d:"·ÉÆ·Éê·É≠·Éù 200·Éí + ·Éê·É†·Éê·É•·Éò·É°·Éò·É° ·Éô·Éê·É†·Éê·É•·Éò",p:22,c:380,prep:"·É®·Éî·É£·É†·Éò·Éî"},
    {t:"13:00",l:"·Éö·Éê·Éú·É©·Éò",d:"·É•·Éê·Éó·Éõ·Éò·É° ·É§·Éò·Éö·Éî 300·Éí + ·Éë·É†·Éò·Éú·ÉØ·Éò 200·Éí + ·É°·Éê·Éö·Éê·Éó·Éò",p:62,c:900,prep:"·Éì·Éê·É°·Éï·Éî·Éú·Éî·Éë·Éò·É° ·Éì·É¶·Éî ‚Äî ·Éõ·Éî·É¢·Éò ·É≠·Éê·Éõ·Éî!"},
    {t:"16:00",l:"·É°·Éú·Éî·Éô·Éò 2",d:"·Éõ·Éù·ÉÆ·Éê·É†·É®. ·Éô·Éï·Éî·É†·É™·ÉÆ·Éò 3 + ·Éï·Éê·É®·Éö·Éò",p:19,c:300,prep:"·Éõ·Éê·É™·Éò·Éï·É†·Éò·Éì·Éê·Éú"},
    {t:"19:00",l:"·Éï·Éê·ÉÆ·É®·Éê·Éõ·Éò",d:"·Éö·Éù·Éë·Éò·Éù + ·Éõ·Éê·Éô·Éê·É†·Éù·Éú·Éò + ·É•·Éê·Éó·Éõ·Éò 200·Éí",p:44,c:740,prep:"·Éö·Éù·Éë·Éò·Éù + ·Éõ·Éê·Éô·Éê·É†·Éù·Éú·Éò + ·É•·Éê·Éó·Éõ·Éò"},
    {t:"22:00",l:"·É´·Éò·Éö·Éò·É° ·É¨·Éò·Éú",d:"·Éõ·Éê·É¨·Éù·Éú·Éò + ·Éó·ÉÆ·Éò·Éö·Éò",p:16,c:250,prep:"·É≠·Éò·É•·Éê·É®·Éò"},
  ]},
  {day:"·Éô·Éï·Éò",emoji:"üîÑ",meals:[
    {t:"08:00",l:"·É°·Éê·É£·Éñ·Éõ·Éî",d:"·Éù·Éõ·Éö·Éî·É¢·Éò 4 ·Éô·Éï·Éî·É†·É™·ÉÆ·Éò + ·Éß·Éï·Éî·Éö·Éò + ·Éû·É£·É†·Éò",p:34,c:680,prep:"MEAL PREP ·Éì·É¶·Éî! ·Éõ·Éù·ÉÆ·Éê·É†·É®·Éî ·Éë·É†·Éò·Éú·ÉØ·Éò/·Éô·Éï·Éî·É†·É™·ÉÆ·Éò ·Éô·Éï·Éò·É†·Éò·É°·Éó·Éï·Éò·É°"},
    {t:"10:30",l:"·É°·Éú·Éî·Éô·Éò",d:"·Éë·Éê·Éú·Éê·Éú·Éò 2 + ·Éê·É†·Éê·É•. ·Éô·Éê·É†·Éê·É•·Éò",p:10,c:380,prep:""},
    {t:"13:00",l:"·Éö·Éê·Éú·É©·Éò",d:"·É•·Éê·Éó·Éõ·Éò·É° ·Éë·Éê·É†·Éô·Éê·Éö·Éò 300·Éí + ·Éë·É†·Éò·Éú·ÉØ·Éò 200·Éí",p:52,c:840,prep:"·Éõ·Éù·Éê·Éõ·Éñ·Éê·Éì·Éî ·Éô·Éï·Éò·É†·Éò·É°·Éó·Éï·Éò·É°·Éê·É™"},
    {t:"16:00",l:"·É°·Éú·Éî·Éô·Éò 2",d:"·ÉÆ·Éê·É≠·Éù 200·Éí + ·Éë·Éê·Éú·Éê·Éú·Éò",p:20,c:280,prep:""},
    {t:"19:00",l:"·Éï·Éê·ÉÆ·É®·Éê·Éõ·Éò",d:"·Éù·É°·Éû·Éò·É° ·É¨·Éï·Éú·Éò·Éê·Éú·Éò + ·É•·Éê·Éó·Éõ·Éò 200·Éí + ·Éû·É£·É†·Éò",p:45,c:720,prep:"·Éù·É°·Éû·Éò·É° ·É¨·Éï·Éú·Éò·Éê·Éú·Éò ·Éõ·Éî·É¢·Éò ·Éí·Éê·Éê·Éô·Éî·Éó·Éî ‚Äî ·Éí·Éê·Éß·Éò·Éú·Éî!"},
    {t:"22:00",l:"·É´·Éò·Éö·Éò·É° ·É¨·Éò·Éú",d:"·ÉÆ·Éê·É≠·Éù 150·Éí + ·Éó·ÉÆ·Éò·Éö·Éò 30·Éí",p:18,c:260,prep:""},
  ]},
];

const MC=["#ff6b35","#f7c948","#4caf50","#29b6f6","#ab47bc","#78909c"];
const EMOJIS=["üçó","ü•ö","ü•£","üçö","üßÄ","ü•õ","ü´ò","üçù","ü•ú","üçå","üçû","ü´í","üçé","üå∞","ü•¨","üçØ","ü•©","üêü","ü•¶","üç†","ü•ï","ü´ê","üçì","ü•ù","üßà","ü•´","üçñ","üåΩ","üçÜ","üßÖ","ü´ë","ü•í","üçá","üçä"];

const init={products:DEF_PRODUCTS,needs:DEF_NEEDS,purchased:{},log:[],spent:0,budget:400,meals:{},wLog:[],day:0,weight:62};

function reducer(s,a){
  let n;
  switch(a.type){
    case "INIT":return{...init,...a.d};
    case "DAY":n={...s,day:a.v};break;
    case "MEAL":{const k=`${a.di}-${a.mi}`;n={...s,meals:{...s.meals,[k]:!s.meals[k]}};break}
    case "BUY":{
      const pr=s.products.find(x=>x.id===a.id);if(!pr)return s;
      const ap=a.cp!=null?a.cp:pr.price;
      const p={...s.purchased,[a.id]:(s.purchased[a.id]||0)+(a.q||1)};
      const lg=[...s.log,{id:a.id,n:pr.name,e:pr.emoji,q:a.q||1,up:ap,tot:ap*(a.q||1),dt:new Date().toLocaleDateString('ka-GE'),st:a.st||pr.store}];
      const prods=a.cp!=null?s.products.map(x=>x.id===a.id?{...x,price:a.cp}:x):s.products;
      const prods2=a.st?prods.map(x=>x.id===a.id?{...x,store:a.st}:x):prods;
      n={...s,purchased:p,log:lg,spent:Math.round((s.spent+ap*(a.q||1))*100)/100,products:prods2};break;
    }
    case "UNBUY":{
      const pr=s.products.find(x=>x.id===a.id);if(!pr||!s.purchased[a.id])return s;
      const p={...s.purchased};p[a.id]=Math.max(0,p[a.id]-1);if(p[a.id]<=0)delete p[a.id];
      const ll=[...s.log].reverse().find(l=>l.id===a.id);
      const rf=ll?ll.up:pr.price;
      const lg=s.log.slice();const idx=lg.findLastIndex(l=>l.id===a.id);if(idx>=0)lg.splice(idx,1);
      n={...s,purchased:p,log:lg,spent:Math.max(0,Math.round((s.spent-rf)*100)/100)};break;
    }
    case "PRICE":{n={...s,products:s.products.map(p=>p.id===a.id?{...p,price:a.v}:p)};break}
    case "STORE":{n={...s,products:s.products.map(p=>p.id===a.id?{...p,store:a.v}:p)};break}
    case "ADD_PROD":{
      const np={...a.prod,id:"c_"+Date.now()};
      const prods=[...s.products,np];
      const needs=a.qty?[...s.needs,{id:np.id,qty:a.qty}]:s.needs;
      n={...s,products:prods,needs};break;
    }
    case "DEL_PROD":{
      n={...s,products:s.products.filter(p=>p.id!==a.id),needs:s.needs.filter(n=>n.id!==a.id),purchased:{...s.purchased,[a.id]:undefined}};break;
    }
    case "WLOG":{
      n={...s,wLog:[...s.wLog,{dt:new Date().toLocaleDateString('ka-GE'),w:a.w}],weight:a.w};break;
    }
    case "BUDGET":n={...s,budget:a.v};break;
    case "RESET":n={...s,purchased:{},log:[],spent:0,meals:{}};break;
    default:return s;
  }
  save(n);return n;
}

// ‚ïê‚ïê‚ïê COMPONENTS ‚ïê‚ïê‚ïê
function Bar({v,max,color,label,h=8}){
  const pct=max>0?Math.min(100,Math.round(v/max*100)):0;
  return React.createElement("div",{className:"bar-wrap"},
    label&&React.createElement("div",{className:"bar-label"},React.createElement("span",null,label),React.createElement("span",{style:{color}},pct+"%")),
    React.createElement("div",{className:"bar-bg",style:{height:h}},React.createElement("div",{className:"bar-fill",style:{width:pct+"%",background:color}}))
  );
}

function Stat({v,u,l,color,icon}){
  return React.createElement("div",{className:"stat",style:{background:color+"11",border:"1px solid "+color+"22"}},
    React.createElement("div",{style:{fontSize:10}},icon),
    React.createElement("div",{className:"val",style:{color}},v,u&&React.createElement("span",{style:{fontSize:11,fontWeight:500}},u)),
    React.createElement("div",{className:"lbl"},l)
  );
}

function Modal({open,close,title,children}){
  if(!open)return null;
  return React.createElement("div",{className:"overlay"},
    React.createElement("div",{className:"overlay-bg",onClick:close}),
    React.createElement("div",{className:"modal"},
      React.createElement("div",{className:"modal-head"},
        React.createElement("span",{className:"modal-title"},title),
        React.createElement("button",{className:"modal-close",onClick:close},"‚úï")
      ),children
    )
  );
}

// ‚ïê‚ïê‚ïê APP ‚ïê‚ïê‚ïê
function App(){
  const [s,dispatch]=useReducer(reducer,init);
  const [tab,setTab]=useState("home");
  const [wi,setWi]=useState("");
  const [sp,setSp]=useState(null);
  // modals
  const [ep,setEp]=useState(null);const [epV,setEpV]=useState("");const [esV,setEsV]=useState("");
  const [ap,setAp]=useState(false);
  const [bm,setBm]=useState(null);const [bq,setBq]=useState("1");const [bp,setBp]=useState("");const [bs,setBs]=useState("");
  const [hm,setHm]=useState(false);
  const [be,setBe]=useState(false);const [bi,setBi]=useState("");
  const [np,setNp]=useState({name:"",unit:"·Éô·Éí",price:"",prot:"",cal:"",store:"",emoji:"üçó",mq:"1"});

  useEffect(()=>{const d=load();if(d)dispatch({type:"INIT",d});},[]);

  const {products,needs,purchased,log,spent,budget,meals,wLog,day,weight}=s;
  const tc=Math.round((10*weight+6.25*175-5*22+5)*1.55+450);
  const tp=Math.round(weight*2.2);
  const dm=MENU[day];
  const dp=dm.meals.reduce((a,m)=>a+m.p,0);
  const dc=dm.meals.reduce((a,m)=>a+m.c,0);
  const cp=dm.meals.filter((_,i)=>meals[`${day}-${i}`]).reduce((a,m)=>a+m.p,0);
  const cc=dm.meals.filter((_,i)=>meals[`${day}-${i}`]).reduce((a,m)=>a+m.c,0);
  const rem=budget-spent;

  const e=React.createElement;

  // ‚îÄ‚îÄ‚îÄ TAB CONTENT ‚îÄ‚îÄ‚îÄ
  let content;

  if(tab==="home"){
    content=e("div",null,
      // Weight
      e("div",{className:"card"},
        e("div",{style:{fontSize:13,fontWeight:700,color:"#ff6b35",marginBottom:8}},"üéØ ·É¨·Éù·Éú·Éò·É° ·Éû·É†·Éù·Éí·É†·Éî·É°·Éò"),
        e("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6}},
          e("span",{style:{fontSize:26,fontWeight:900}},weight,e("span",{style:{fontSize:13,color:"#888"}},"·Éô·Éí")),
          e("span",{style:{color:"#555"}},"‚Üí"),
          e("span",{style:{fontSize:26,fontWeight:900,color:"#ff6b35"}},"73",e("span",{style:{fontSize:13}},"·Éô·Éí"))
        ),
        e(Bar,{v:Math.max(0,weight-62),max:11,color:"#ff6b35",label:`+${Math.max(0,weight-62).toFixed(1)}·Éô·Éí / 11·Éô·Éí`,h:10}),
        e("div",{style:{display:"flex",gap:8,marginTop:10}},
          e("input",{className:"inp",type:"number",placeholder:"·Éê·ÉÆ·Éê·Éö·Éò ·É¨·Éù·Éú·Éê...",value:wi,onChange:x=>setWi(x.target.value)}),
          e("button",{className:"btn btn-primary",onClick:()=>{if(wi){dispatch({type:"WLOG",w:parseFloat(wi)});setWi("")}}},"·É©·Éê·É¨·Éî·É†·Éî")
        )
      ),
      // Stats
      e("div",{style:{display:"flex",gap:6,marginBottom:10}},
        e(Stat,{v:tc,l:"·Éô·Éô·Éê·Éö/·Éì·É¶·Éî",color:"#f7c948",icon:"üî•"}),
        e(Stat,{v:tp,u:"·Éí",l:"·Éû·É†·Éù·É¢·Éî·Éò·Éú·Éò",color:"#ff6b35",icon:"üí™"}),
        e(Stat,{v:rem.toFixed(0),u:"‚Çæ",l:"·Éì·Éê·É†·É©·Éê",color:"#66bb6a",icon:"üí∞"})
      ),
      // Today
      e("div",{className:"card"},
        e("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8}},
          e("span",{style:{fontSize:12,fontWeight:700,color:"#4caf50"}},`üìÖ ${dm.emoji} ${dm.day}`),
          e("span",{style:{fontSize:11,color:"#888"}},dm.meals.filter((_,i)=>meals[`${day}-${i}`]).length+"/6")
        ),
        e(Bar,{v:cp,max:dp,color:"#ff6b35",label:`·Éû·É†·Éù·É¢·Éî·Éò·Éú·Éò: ${cp}/${dp}·Éí`}),
        e("div",{style:{height:4}}),
        e(Bar,{v:cc,max:dc,color:"#f7c948",label:`·Éô·Éê·Éö·Éù·É†·Éò·Éê: ${cc}/${dc}`}),
        e("button",{className:"btn btn-outline btn-full",style:{marginTop:10},onClick:()=>setTab("menu")},"·Éõ·Éî·Éú·Éò·É£·É° ·Éú·Éê·ÉÆ·Éï·Éê ‚Üí")
      ),
      // Weight history mini
      wLog.length>0&&e("div",{className:"card"},
        e("div",{style:{fontSize:12,fontWeight:700,color:"#888",marginBottom:6}},"üìà ·Éë·Éù·Éö·Éù ·É©·Éê·Éú·Éê·É¨·Éî·É†·Éî·Éë·Éò"),
        e("div",{style:{display:"flex",alignItems:"flex-end",gap:3,height:60}},
          wLog.slice(-15).map((x,i)=>e("div",{key:i,style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",gap:1}},
            e("span",{style:{fontSize:7,color:"#888"}},x.w),
            e("div",{style:{width:"100%",height:Math.max(4,((x.w-58)/17)*50),background:"linear-gradient(to top,#ff6b35,#f7c948)",borderRadius:2}})
          ))
        )
      )
    );
  }

  else if(tab==="menu"){
    content=e("div",null,
      e("div",{style:{display:"flex",gap:4,marginBottom:12,overflowX:"auto"}},
        MENU.map((d,i)=>e("button",{key:i,className:"day-btn"+(day===i?" active":""),onClick:()=>dispatch({type:"DAY",v:i})},
          e("div",{style:{fontSize:15}},d.emoji),
          e("div",{style:{fontWeight:day===i?800:400}},d.day)
        ))
      ),
      e("div",{style:{display:"flex",gap:6,marginBottom:12}},
        e(Stat,{v:cp,u:`/${dp}`,l:"·Éû·É†·Éù·É¢·Éî·Éò·Éú·Éò",color:"#ff6b35",icon:"üí™"}),
        e(Stat,{v:cc,u:`/${dc}`,l:"·Éô·Éê·Éö·Éù·É†·Éò·Éê",color:"#f7c948",icon:"üî•"})
      ),
      e("div",{style:{display:"flex",flexDirection:"column",gap:5}},
        dm.meals.map((m,mi)=>{
          const k=`${day}-${mi}`;const done=meals[k];const exp=sp===k;
          return e("div",{key:mi,className:"meal-card",style:{background:done?"rgba(76,175,80,.05)":"rgba(255,255,255,.03)",borderLeft:`4px solid ${done?"#4caf50":MC[mi]}`,opacity:done?.65:1}},
            e("div",{style:{padding:"10px 12px"}},
              e("div",{style:{display:"flex",alignItems:"center",gap:8}},
                e("button",{className:"meal-check"+(done?" done":""),onClick:()=>dispatch({type:"MEAL",di:day,mi})},done?"‚úì":""),
                e("div",{style:{flex:1}},
                  e("div",{style:{display:"flex",justifyContent:"space-between"}},
                    e("div",null,e("span",{style:{fontSize:10,color:"#666"}},m.t),e("span",{style:{fontSize:12,fontWeight:700,color:done?"#4caf50":"#fff",marginLeft:6}},m.l)),
                    e("div",{style:{display:"flex",gap:4}},
                      e("span",{className:"chip",style:{background:"#ff6b3518",color:"#ff6b35"}},m.p+"·Éí"),
                      e("span",{className:"chip",style:{background:"#f7c94815",color:"#f7c948"}},m.c)
                    )
                  ),
                  e("div",{style:{fontSize:11,color:"#999",marginTop:3,textDecoration:done?"line-through":"none"}},m.d)
                )
              ),
              m.prep&&e("button",{className:"prep-btn",onClick:()=>setSp(exp?null:k)},exp?"üç≥ ·Éì·Éê·Éõ·Éê·Éö·Éî":"üç≥ ·Éõ·Éù·Éõ·Éñ·Éê·Éì·Éî·Éë·Éê")
            ),
            exp&&m.prep&&e("div",{className:"prep-content"},"üç≥ "+m.prep)
          );
        })
      )
    );
  }

  else if(tab==="shop"){
    content=e("div",null,
      e("div",{style:{display:"flex",gap:6,marginBottom:10}},
        e("button",{className:"btn btn-outline btn-sm",onClick:()=>setHm(true)},"üìú ·Éò·É°·É¢·Éù·É†·Éò·Éê"),
        e("button",{className:"btn btn-danger btn-sm",onClick:()=>{if(confirm("·Éê·ÉÆ·Éê·Éö·Éò ·Éó·Éï·Éî? ·Éß·Éï·Éî·Éö·Éê·É§·Éî·É†·Éò ·É¨·Éê·Éò·É®·Éö·Éî·Éë·Éê"))dispatch({type:"RESET"})}},"üîÑ ·Éê·ÉÆ·Éê·Éö·Éò ·Éó·Éï·Éî"),
        e("div",{style:{flex:1}}),
        e("button",{className:"btn btn-primary btn-sm",onClick:()=>setAp(true)},"‚ûï")
      ),
      e(Bar,{v:spent,max:budget,color:rem<50?"#ef5350":"#ff6b35",label:`${spent.toFixed(0)}‚Çæ / ${budget}‚Çæ ‚Äî ${rem.toFixed(0)}‚Çæ ·Éì·Éê·É†·É©·Éê`,h:8}),
      e("div",{style:{height:10}}),
      e("div",{style:{display:"flex",flexDirection:"column",gap:4}},
        needs.map((nd,i)=>{
          const pr=products.find(x=>x.id===nd.id);if(!pr)return null;
          const bt=purchased[nd.id]||0;const dn=bt>=nd.qty;const pct=nd.qty>0?Math.min(100,Math.round(bt/nd.qty*100)):0;
          return e("div",{key:i,className:"shop-item"+(dn?" done":""),style:{background:dn?"rgba(76,175,80,.05)":"rgba(255,255,255,.03)"}},
            e("div",{style:{display:"flex",alignItems:"center",gap:8}},
              e("span",{style:{fontSize:20}},pr.emoji),
              e("div",{style:{flex:1}},
                e("div",{style:{display:"flex",justifyContent:"space-between"}},
                  e("span",{style:{fontSize:12,fontWeight:700,color:dn?"#66bb6a":"#fff"}},dn?"‚úì ":"",pr.name),
                  e("button",{style:{background:"none",border:"none",cursor:"pointer",padding:0},onClick:()=>{setEp(pr);setEpV(String(pr.price));setEsV(pr.store)}},
                    e("span",{style:{fontSize:11,color:"#ff6b35",fontWeight:700}},pr.price+"‚Çæ",e("span",{style:{color:"#555",fontWeight:400}},"/"+pr.unit)," ‚úèÔ∏è")
                  )
                ),
                e("div",{style:{fontSize:10,color:"#777",marginTop:2}},`${bt}/${nd.qty} ${pr.unit} ¬∑ `,e("span",{style:{color:"#556"}},pr.store)),
                e("div",{style:{marginTop:3,width:"100%",height:3,background:"rgba(255,255,255,.06)",borderRadius:10}},
                  e("div",{style:{width:pct+"%",height:3,background:dn?"#4caf50":"#ff6b35",borderRadius:10,transition:"width .3s"}})
                )
              ),
              e("div",{style:{display:"flex",flexDirection:"column",gap:3}},
                e("button",{className:"qty-btn",style:{background:dn?"#333":"#ff6b35",color:dn?"#666":"#000"},onClick:()=>{setBm(pr);setBq("1");setBp("");setBs("")}},"+"),
                e("button",{className:"qty-btn",style:{background:"rgba(255,255,255,.06)",color:"#888"},onClick:()=>dispatch({type:"UNBUY",id:nd.id})},"‚àí")
              )
            )
          );
        })
      )
    );
  }

  else if(tab==="products"){
    content=e("div",null,
      e("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:10}},
        e("span",{style:{fontSize:14,fontWeight:700,color:"#ff6b35"}},"üì¶ ·Éû·É†·Éù·Éì·É£·É•·É¢·Éî·Éë·Éò"),
        e("button",{className:"btn btn-primary btn-sm",onClick:()=>setAp(true)},"‚ûï ·Éê·ÉÆ·Éê·Éö·Éò")
      ),
      e("div",{style:{fontSize:10,color:"#555",marginBottom:8}},"·Éì·Éê·Éê·É≠·Éò·É†·Éî ·É§·Éê·É°·Éò·É°/·Éõ·Éê·É¶·Éê·Éñ·Éò·Éò·É° ·É®·Éî·É°·Éê·É™·Éï·Éö·Éî·Éö·Éê·Éì"),
      e("div",{style:{display:"flex",padding:"6px 0",borderBottom:"1px solid #222"}},
        e("span",{style:{flex:2,fontSize:10,fontWeight:700,color:"#555"}},"·Éû·É†·Éù·Éì·É£·É•·É¢·Éò"),
        e("span",{style:{flex:1,fontSize:10,fontWeight:700,color:"#ff6b35",textAlign:"center"}},"·É™·Éò·Éö·Éê"),
        e("span",{style:{flex:1,fontSize:10,fontWeight:700,color:"#f7c948",textAlign:"center"}},"·Éô·Éô·Éê·Éö"),
        e("span",{style:{flex:1,fontSize:10,fontWeight:700,color:"#66bb6a",textAlign:"center"}},"·É§·Éê·É°·Éò")
      ),
      products.sort((a,b)=>b.prot-a.prot).map((p,i)=>
        e("div",{key:i,className:"prod-row",onClick:()=>{setEp(p);setEpV(String(p.price));setEsV(p.store)}},
          e("span",{style:{flex:2,fontSize:11}},p.emoji+" "+p.name),
          e("span",{style:{flex:1,fontSize:11,fontWeight:700,color:"#ff6b35",textAlign:"center"}},p.prot+"·Éí"),
          e("span",{style:{flex:1,fontSize:11,color:"#f7c948",textAlign:"center"}},p.cal),
          e("span",{style:{flex:1,fontSize:11,color:"#66bb6a",textAlign:"center"}},p.price+"‚Çæ")
        )
      ),
      // Meal prep
      e("div",{style:{marginTop:14,background:"rgba(247,201,72,.05)",borderRadius:12,padding:12,border:"1px solid rgba(247,201,72,.1)"}},
        e("div",{style:{fontSize:12,fontWeight:700,color:"#f7c948",marginBottom:6}},"üç≥ Meal Prep (·Éô·Éï·Éò·É†·Éê)"),
        ["·Éë·É†·Éò·Éú·ÉØ·Éò 1.5·Éô·Éí ·Éõ·Éù·ÉÆ·Éê·É†·É®·Éî ‚Äî 20·É¨·Éó","·Éô·Éï·Éî·É†·É™·ÉÆ·Éò 15-18·É™ ·Éõ·Éù·ÉÆ·Éê·É†·É®·Éî ‚Äî 12·É¨·Éó","·É•·Éê·Éó·Éõ·Éò·É° ·É§·Éò·Éö·Éî 1.5·Éô·Éí ·É®·Éî·É¨·Éï·Éò ‚Äî 25·É¨·Éó","·Éù·É°·Éû·Éò 500·Éí ·Éõ·Éù·ÉÆ·Éê·É†·É®·Éî ‚Äî 20·É¨·Éó","·Éô·Éù·Éú·É¢·Éî·Éò·Éú·Éî·É†·Éî·Éë·É®·Éò ·Éì·Éê·Éê·Éö·Éê·Éí·Éî ‚Äî 10·É¨·Éó"].map((x,i)=>
          e("div",{key:i,style:{fontSize:11,color:"#bbb",padding:"3px 0"}},"‚ñ∏ "+x)
        )
      )
    );
  }

  else if(tab==="stats"){
    const tdee=Math.round((10*weight+6.25*175-5*22+5)*1.55);
    content=e("div",null,
      e("div",{className:"card"},
        e("div",{style:{fontSize:13,fontWeight:700,color:"#ff6b35",marginBottom:10}},"üìà ·É¨·Éù·Éú·Éò·É° ·Éò·É°·É¢·Éù·É†·Éò·Éê"),
        wLog.length===0?e("div",{style:{textAlign:"center",padding:20,color:"#555"}},"‚öñÔ∏è ·ÉØ·Éî·É† ·Éê·É† ·É©·Éê·Éí·Éò·É¨·Éî·É†·Éò·Éê"):
        e("div",null,
          e("div",{style:{display:"flex",alignItems:"flex-end",gap:3,height:100}},
            wLog.slice(-20).map((x,i)=>e("div",{key:i,style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",gap:1}},
              e("span",{style:{fontSize:8,color:"#888"}},x.w),
              e("div",{style:{width:"100%",height:Math.max(6,((x.w-58)/17)*100)+"%",minHeight:6,background:"linear-gradient(to top,#ff6b35,#f7c948)",borderRadius:3}})
            ))
          ),
          e("div",{style:{textAlign:"center",fontSize:10,color:"#555",borderTop:"1px dashed #333",paddingTop:4,marginTop:4}},"·É°·Éê·Éõ·Éò·Éñ·Éú·Éî: 73·Éô·Éí")
        )
      ),
      e("div",{className:"card"},
        e("div",{style:{fontSize:13,fontWeight:700,color:"#f7c948",marginBottom:8}},"üî¨ ·Éõ·Éê·Éô·É†·Éù·Éî·Éë·Éò"),
        e("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:6}},
          [{l:"TDEE",v:tdee},{l:"·É°·Éê·Éõ·Éò·Éñ·Éú·Éî",v:tc},{l:"·Éû·É†·Éù·É¢·Éî·Éò·Éú·Éò",v:tp+"·Éí"},{l:"·É™·ÉÆ·Éò·Éõ·Éò",v:Math.round(weight*.9)+"·Éí"},{l:"·Éú·Éê·ÉÆ·É®·É¨·Éß.",v:Math.round((tc-tp*4-Math.round(weight*.9)*9)/4)+"·Éí"},{l:"·É°·É£·É†·Éû·Éö·É£·É°·Éò",v:"+450"}].map((x,i)=>
            e("div",{key:i,style:{background:"#111",borderRadius:8,padding:"8px 6px",textAlign:"center"}},
              e("div",{style:{fontSize:9,color:"#666"}},x.l),e("div",{style:{fontSize:15,fontWeight:800}},x.v)
            )
          )
        )
      ),
      e("div",{className:"card"},
        e("div",{style:{fontSize:13,fontWeight:700,color:"#66bb6a",marginBottom:8}},"üí∞ ·Éë·Éò·É£·ÉØ·Éî·É¢·Éò"),
        e("div",{style:{display:"flex",gap:6}},e(Stat,{v:spent.toFixed(0),u:"‚Çæ",l:"·Éì·Éê·ÉÆ·Éê·É†·ÉØ·É£·Éö·Éò",color:"#ef5350",icon:"üí∏"}),e(Stat,{v:rem.toFixed(0),u:"‚Çæ",l:"·Éì·Éê·É†·É©·Éê",color:"#66bb6a",icon:"üí∞"})),
        e(Bar,{v:spent,max:budget,color:"#ff6b35",label:`·Éë·Éò·É£·ÉØ·Éî·É¢·Éò·É° ${Math.round(spent/budget*100)}%`,h:8}),
        log.length>0&&e("div",{style:{marginTop:8}},
          e("div",{style:{fontSize:11,color:"#888",marginBottom:4}},"·Éë·Éù·Éö·Éù ·É®·Éî·É´·Éî·Éú·Éî·Éë·Éò:"),
          [...log].reverse().slice(0,5).map((l,i)=>e("div",{key:i,style:{display:"flex",justifyContent:"space-between",fontSize:11,padding:"3px 0",borderBottom:"1px solid #1a1a1a"}},
            e("span",{style:{color:"#bbb"}},l.e+" "+l.n+" √ó"+l.q),
            e("span",{style:{color:"#ff6b35",fontWeight:700}},l.tot.toFixed(1)+"‚Çæ ",e("span",{style:{color:"#555",fontWeight:400}},"("+l.up+"‚Çæ)"))
          ))
        )
      )
    );
  }

  // ‚îÄ‚îÄ‚îÄ RENDER ‚îÄ‚îÄ‚îÄ
  return e("div",null,
    // Header
    e("div",{className:"header"},
      e("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},
        e("div",null,
          e("div",{style:{fontSize:20,fontWeight:900,color:"#0a0a0f"}},"BULK MODE üèãÔ∏è"),
          e("div",{style:{fontSize:11,color:"#333",fontWeight:600}},weight+"·Éô·Éí ‚Üí 73·Éô·Éí ¬∑ "+tc+"·Éô·Éô·Éê·Éö/·Éì·É¶·Éî")
        ),
        e("div",{onClick:()=>{setBe(true);setBi(String(budget))},style:{background:"rgba(0,0,0,.12)",borderRadius:10,padding:"6px 12px",textAlign:"center",cursor:"pointer"}},
          e("div",{style:{fontSize:16,fontWeight:900,color:"#0a0a0f"}},rem.toFixed(0)+"‚Çæ"),
          e("div",{style:{fontSize:8,color:"#333",fontWeight:600}},"·Éì·Éê·É†·É©·Éî·Éú·Éò·Éö·Éò ‚ñæ")
        )
      ),
      e("div",{style:{marginTop:6}},
        e(Bar,{v:spent,max:budget,color:"#0a0a0f",h:5}),
        e("div",{style:{display:"flex",justifyContent:"space-between",fontSize:9,color:"#444",marginTop:2}},
          e("span",null,spent.toFixed(0)+"‚Çæ ·Éì·Éê·ÉÆ·Éê·É†·ÉØ·É£·Éö·Éò"),e("span",null,budget+"‚Çæ"))
      )
    ),
    // Content
    e("div",{className:"content"},content),
    // Bottom nav
    e("div",{className:"tab-bar"},
      [{id:"home",icon:"üè†",l:"·Éõ·Éó·Éê·Éï·Éê·É†·Éò"},{id:"menu",icon:"üçΩÔ∏è",l:"·Éõ·Éî·Éú·Éò·É£"},{id:"shop",icon:"üõí",l:"·É°·Éê·Éß·Éò·Éì·Éö·Éî·Éë·Éò"},{id:"products",icon:"üì¶",l:"·Éû·É†·Éù·Éì·É£·É•·É¢·Éî·Éë·Éò"},{id:"stats",icon:"üìä",l:"·É°·É¢·Éê·É¢·Éò·É°·É¢·Éò·Éô·Éê"}].map(t=>
        e("button",{key:t.id,className:"tab-btn"+(tab===t.id?" active":""),onClick:()=>setTab(t.id)},
          e("div",{className:"icon"},t.icon),e("div",{className:"label"},t.l)
        )
      )
    ),
    // ‚ïê‚ïê‚ïê MODALS ‚ïê‚ïê‚ïê
    // Budget
    e(Modal,{open:be,close:()=>setBe(false),title:"üí∞ ·Éë·Éò·É£·ÉØ·Éî·É¢·Éò"},
      e("input",{className:"inp",type:"number",value:bi,onChange:x=>setBi(x.target.value),placeholder:"·Éê·ÉÆ·Éê·Éö·Éò ·Éë·Éò·É£·ÉØ·Éî·É¢·Éò..."}),
      e("div",{style:{height:10}}),
      e("button",{className:"btn btn-primary btn-full",onClick:()=>{if(bi){dispatch({type:"BUDGET",v:parseFloat(bi)});setBe(false)}}},"·É®·Éî·Éú·Éê·ÉÆ·Éï·Éê")
    ),
    // Buy
    e(Modal,{open:!!bm,close:()=>setBm(null),title:bm?`${bm.emoji} ${bm.name} ‚Äî ·É®·Éî·É´·Éî·Éú·Éê`:""},
      bm&&e("div",null,
        e("div",{style:{background:"#111",borderRadius:12,padding:12,marginBottom:12}},
          e("div",{style:{fontSize:12,color:"#888",marginBottom:4}},"·Éú·Éê·Éí·É£·Éö·Éò·É°·ÉÆ·Éõ·Éî·Éï·Éò: ",e("span",{style:{color:"#ff6b35",fontWeight:700}},bm.price+"‚Çæ/"+bm.unit)),
          e("div",{style:{fontSize:12,color:"#888"}},"·Éõ·Éê·É¶·Éê·Éñ·Éò·Éê: ",e("span",{style:{color:"#66bb6a"}},bm.store))
        ),
        e("div",{style:{fontSize:12,fontWeight:700,color:"#f7c948",marginBottom:6}},"·É†·Éê·Éù·Éì·Éî·Éú·Éù·Éë·Éê ("+bm.unit+")"),
        e("input",{className:"inp",type:"number",value:bq,onChange:x=>setBq(x.target.value)}),
        e("div",{style:{fontSize:12,fontWeight:700,color:"#f7c948",marginTop:12,marginBottom:6}},"·É§·Éê·É•·É¢·Éò·É£·É†·Éò ·É§·Éê·É°·Éò (‚Çæ/"+bm.unit+") ",e("span",{style:{color:"#888",fontWeight:400}},"·Éó·É£ ·Éí·Éê·Éú·É°·ÉÆ·Éï·Éê·Éï·Éì·Éî·Éë·Éê")),
        e("input",{className:"inp",type:"number",value:bp,onChange:x=>setBp(x.target.value),placeholder:bm.price+" (·Éú·Éê·Éí·É£·Éö·Éò·É°·ÉÆ·Éõ·Éî·Éï·Éò)"}),
        e("div",{style:{fontSize:12,fontWeight:700,color:"#f7c948",marginTop:12,marginBottom:6}},"·É°·Éê·Éì ·Éò·Éß·Éò·Éì·Éî?"),
        e("input",{className:"inp",value:bs,onChange:x=>setBs(x.target.value),placeholder:bm.store}),
        e("div",{style:{marginTop:14,background:"rgba(255,107,53,.06)",borderRadius:10,padding:10,textAlign:"center"}},
          "·É°·É£·Éö: ",e("span",{style:{fontWeight:900,color:"#ff6b35",fontSize:18}},((bp?parseFloat(bp):bm.price)*(parseFloat(bq)||1)).toFixed(1)+"‚Çæ")
        ),
        e("div",{style:{height:12}}),
        e("button",{className:"btn btn-primary btn-full",onClick:()=>{
          dispatch({type:"BUY",id:bm.id,q:parseFloat(bq)||1,cp:bp?parseFloat(bp):null,st:bs||undefined});
          setBm(null);setBq("1");setBp("");setBs("");
        }},"‚úì ·Éï·Éò·Éß·Éò·Éì·Éî")
      )
    ),
    // Edit price
    e(Modal,{open:!!ep,close:()=>setEp(null),title:ep?`‚úèÔ∏è ${ep.emoji} ${ep.name}`:""},
      ep&&e("div",null,
        e("div",{style:{fontSize:12,color:"#888",marginBottom:8}},"·Éê·ÉÆ·Éö·Éê·Éú·Éì·Éî·Éö·Éò: ",e("span",{style:{color:"#ff6b35",fontWeight:700}},ep.price+"‚Çæ/"+ep.unit)," ¬∑ ",e("span",{style:{color:"#66bb6a"}},ep.store)),
        e("div",{style:{fontSize:12,fontWeight:700,color:"#f7c948",marginBottom:6}},"·Éê·ÉÆ·Éê·Éö·Éò ·É§·Éê·É°·Éò (‚Çæ)"),
        e("input",{className:"inp",type:"number",value:epV,onChange:x=>setEpV(x.target.value)}),
        e("div",{style:{fontSize:12,fontWeight:700,color:"#f7c948",marginTop:10,marginBottom:6}},"·Éõ·Éê·É¶·Éê·Éñ·Éò·Éê"),
        e("input",{className:"inp",value:esV,onChange:x=>setEsV(x.target.value)}),
        e("div",{style:{height:12}}),
        e("div",{style:{display:"flex",gap:8}},
          e("button",{className:"btn btn-primary",style:{flex:1},onClick:()=>{
            if(epV)dispatch({type:"PRICE",id:ep.id,v:parseFloat(epV)});
            if(esV)dispatch({type:"STORE",id:ep.id,v:esV});
            setEp(null);
          }},"üíæ ·É®·Éî·Éú·Éê·ÉÆ·Éï·Éê"),
          ep.id.startsWith("c_")&&e("button",{className:"btn btn-danger",onClick:()=>{dispatch({type:"DEL_PROD",id:ep.id});setEp(null)}},"üóëÔ∏è ·É¨·Éê·É®·Éö·Éê")
        )
      )
    ),
    // Add product
    e(Modal,{open:ap,close:()=>setAp(false),title:"‚ûï ·Éê·ÉÆ·Éê·Éö·Éò ·Éû·É†·Éù·Éì·É£·É•·É¢·Éò"},
      e("div",{style:{display:"flex",gap:6,flexWrap:"wrap",marginBottom:12}},
        EMOJIS.map(em=>e("button",{key:em,className:"emoji-btn",style:{background:np.emoji===em?"#ff6b35":"#222"},onClick:()=>setNp({...np,emoji:em})},em))
      ),
      e("div",{style:{display:"flex",flexDirection:"column",gap:8}},
        e("input",{className:"inp",value:np.name,onChange:x=>setNp({...np,name:x.target.value}),placeholder:"·É°·Éê·ÉÆ·Éî·Éö·Éò *"}),
        e("div",{style:{display:"flex",gap:8}},
          e("input",{className:"inp",type:"number",value:np.price,onChange:x=>setNp({...np,price:x.target.value}),placeholder:"·É§·Éê·É°·Éò (‚Çæ) *"}),
          e("input",{className:"inp",value:np.unit,onChange:x=>setNp({...np,unit:x.target.value}),placeholder:"·Éî·É†·Éó·Éî·É£·Éö·Éò",style:{maxWidth:100}})
        ),
        e("div",{style:{display:"flex",gap:8}},
          e("input",{className:"inp",type:"number",value:np.prot,onChange:x=>setNp({...np,prot:x.target.value}),placeholder:"·É™·Éò·Éö·Éê/100·Éí"}),
          e("input",{className:"inp",type:"number",value:np.cal,onChange:x=>setNp({...np,cal:x.target.value}),placeholder:"·Éô·Éô·Éê·Éö/100·Éí"})
        ),
        e("input",{className:"inp",value:np.store,onChange:x=>setNp({...np,store:x.target.value}),placeholder:"·Éõ·Éê·É¶·Éê·Éñ·Éò·Éê"}),
        e("div",{style:{display:"flex",gap:8,alignItems:"center"}},
          e("input",{className:"inp",type:"number",value:np.mq,onChange:x=>setNp({...np,mq:x.target.value}),placeholder:"·Éó·Éï·Éò·É£·É†·Éò ·É†·Éê·Éù·Éì·Éî·Éú·Éù·Éë·Éê",style:{maxWidth:140}}),
          e("span",{style:{fontSize:11,color:"#888"}},"·Éó·Éï·Éî·É®·Éò")
        )
      ),
      e("div",{style:{height:14}}),
      e("button",{className:"btn btn-primary btn-full",disabled:!np.name||!np.price,onClick:()=>{
        dispatch({type:"ADD_PROD",prod:{name:np.name,unit:np.unit||"·É™·Éê·Éö·Éò",price:parseFloat(np.price),prot:parseFloat(np.prot)||0,cal:parseFloat(np.cal)||0,store:np.store||"‚Äî",emoji:np.emoji},qty:parseInt(np.mq)||1});
        setNp({name:"",unit:"·Éô·Éí",price:"",prot:"",cal:"",store:"",emoji:"üçó",mq:"1"});setAp(false);
      }},"‚ûï ·Éì·Éê·Éõ·Éê·É¢·Éî·Éë·Éê")
    ),
    // History
    e(Modal,{open:hm,close:()=>setHm(false),title:"üìú ·É®·Éî·É´·Éî·Éú·Éî·Éë·Éò·É° ·Éò·É°·É¢·Éù·É†·Éò·Éê"},
      log.length===0?e("div",{style:{textAlign:"center",padding:30,color:"#666"}},"·ÉØ·Éî·É† ·Éê·É†·Éê·É§·Éî·É†·Éò"):
      e("div",{style:{display:"flex",flexDirection:"column",gap:4}},
        [...log].reverse().map((l,i)=>e("div",{key:i,className:"history-item"},
          e("span",{style:{fontSize:20}},l.e),
          e("div",{style:{flex:1}},
            e("div",{style:{fontSize:12,fontWeight:700}},l.n," √ó",l.q),
            e("div",{style:{fontSize:10,color:"#666"}},l.dt," ¬∑ ",l.st)
          ),
          e("div",{style:{textAlign:"right"}},
            e("div",{style:{fontSize:13,fontWeight:800,color:"#ff6b35"}},l.tot.toFixed(1)+"‚Çæ"),
            e("div",{style:{fontSize:10,color:"#888"}},l.up+"‚Çæ/·É™·Éê·Éö·Éò")
          )
        )),
        e("div",{style:{textAlign:"center",padding:8,fontSize:13,fontWeight:800,color:"#f7c948"}},"·É°·É£·Éö: "+log.reduce((s,l)=>s+l.tot,0).toFixed(1)+"‚Çæ")
      )
    )
  );
}

ReactDOM.render(React.createElement(App),document.getElementById("root"));
</script>
</body>
</html>
